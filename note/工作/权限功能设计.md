## 系统用户及权限功能设计
### 前端界面

http://demo.ruoyi.vip/index


### 功能内容
#### 岗位管理
1. 新增岗位

   输入

2. 修改岗位

3. 删除岗位

4. 查询岗位
   - 根据岗位编码类型查询岗位

   - 根据岗位名称查询岗位 支持like查询

   - 根据岗位状态查询

   - 查询所有岗位

   - 上诉条件都可以相互使用查询

     待考虑内容 电信中组织和岗位存在关系，对于不同的组织可以设置不同的岗位 ，系统中要考虑这块的扩充支撑

     如新增岗位，同时新增岗位所属组织，查询时候可以针对组织查询岗位
#### 菜单管理
1. 新增菜单
   菜单类型（目录，菜单，按钮）、上级菜单
2. 修改菜单
3. 删除菜单 
   删除菜单拥有下级菜单时候需要提示是否删除所有并列出菜单列表
4. 查询菜单
   - 菜单名称查询
   - 菜单状态查询
   - 查询所有菜单
   - 上诉条件都可以相互使用查询
#### 权限管理

1. 新增权限

   权限编码后端按照一定规则自动生成，权限类型（功能权、数据权、混合权），权限管控类别。

   选择权限类型后可以展示对功能权（菜单管理中的内容）进行选择，数据权、混合权后续在考虑

2. 修改权限

3. 删除权限

4. 查询权限

   - 权限名称like查询
   - 权限编码=查询
   - 权限状态查询
   - 权限类型查询 
   - 权限管控级别查询
   - 上诉条件都可以相互使用查询

一些值具体值看主数据excel

ps：权限单独拉出来会导致 配置的复杂度，建议在菜单新增时候是否就可以给权限新增一条记录，目前我们授权是一个权限授权，不是给菜单授权

#### 角色管理

##### 角色授权

1. 新增角色

   新增角色同时可以新增角色涉及的权限 

2. 修改角色

   修改角色同时可以修改角色权限，对角色的增删

3. 删除角色

   删除角色同时可以删除角色所涉及的角色权限

4. 查询角色

   - 根据角色名称查询角色  支持like查询
   - 根据角色状态查询
   - 上诉条件都可以交互使用查询

#### 系统用户

1. 新增系统用户

   新增用户同时选择对应的岗位，以及角色 1个用户可以有多个岗位，也可也有多个角色

2. 修改系统用户

3. 删除系统用户

4. 查询系统用户

   - 通过组织查询系统用户（之前已经做过通过组织查询员工，这块查询也是通过查询员工在查用户，一个员工可以有多个系统用户）
   - 通过登陆名称查询
   - 通过员工状态查询
   - 上诉条件都可以交互使用查询



遗留 缺少区域的一个查询，权限如何控制区域，也是信息权的一部分 ，按照组织来 还是岗位来 ，


### 详细功能内容
#### 系统用户
##### 功能说明
1. 创建一个系统用户（包含系统用户的岗位关联，系统用户包含的角色）
   查询该组织下拥有的岗位（先做查询所有岗位）
   查询系统角色（先做查询所有角色）
4. 修改系统用户
5. 查询系统用户信息
4. 新增角色
5. 新增岗位

##### 流程说明

1. 创建系统用户

   新增用户后在新创建一个系统用户

2. 修改系统用户

3. 不单独删除系统用户系统用户在 员工删除时候跟着删除

4. 查询系统用户信息

##### 表说明

| 表名             | 说明                  |
| ---------------- | --------------------- |
| SYSTEM_USER      | 系统用户              |
| SYSTEM_USER_POST | 系统用户任职岗位      |
| SYSTEM_POST      | 系统岗位，配置表      |
| SYSTEM_USER_ROLE | 系统用户角色          |
| SYSTEM_ROLES     | 系统角色 ，一个配置表 |

##### api 说明

##### 查询组织下拥有的岗位

逻辑：根据组织id查询组织岗位

输入：组织id

输出：SYSTEM_POST

##### 查询所有的岗位

逻辑：查询所有的岗位

输入：

输出：SYSTEM_POST

##### 查询岗位下拥有的角色

逻辑：根据岗位id查询角色

输入：岗位ID

输出：表 SYSTEM_POST、SYSTEM_POST_ROLE 、SYSTEM_ROLES

##### 查询所有角色

逻辑

输入：角色名称

输出：表 SYSTEM_ROLES







##### 新增系统用户涉及表及字段

SYSTEM_USER

| Name                 | Code            | 说明                                   |
| -------------------- | --------------- | -------------------------------------- |
| 系统用户标识         | SYS_USER_ID     |                                        |
| 员工标识             | STAFF_ID        | 先界面传递，后续在缓存中获取到         |
| 账号                 | SYS_USER_CODE   | 界面传递                               |
| 密码                 | PASSWORD        | 界面传递                               |
| 密码错误次数限制     | PWD_ERR_CNT     | 默认6                                  |
| 验证码短信通知手机号 | PWD_SMS_TEL     | 先不用                                 |
| 密码状态             | PWD_STATUS      | 新增默认有效                           |
| 新密码生成时间       | PWD_NEWTIME     | 默认创建时间                           |
| 密码有效天数         | PWD_EFFECT_DAYS | 默认90天                               |
| 区域标识             | REGION_ID       | 按照登陆的用户来传递，后续在缓存中获得 |
| 归属系统             | SYSTEM_INFO_ID  | 先不用                                 |
| 登录次数限制         | LIMIT_COUNT     | 先不用                                 |
| 当前登录次数         | LOGINED_NUM     | 先不用                                 |
| 系统用户描述         | SYS_USER_DESC   | 界面传递                               |
| 生效时间             | EFF_DATE        | 先不用                                 |
| 失效时间             | EXP_DATE        | 先不用                                 |
| 状态                 | STATUS_CD       | 默认生效                               |
| 状态时间             | STATUS_DATE     | 默认时间                               |
| 创建时间             | CREATE_DATE     | 默认时间                               |
| 创建人               | CREATE_STAFF    | 默认人员                               |
| 修改时间             | UPDATE_DATE     | 默认时间                               |
| 修改人               | UPDATE_STAFF    | 默认人员                               |



SYSTEM_USER_POST

| Name                 | Code             |                                |
| -------------------- | ---------------- | ------------------------------ |
| 系统用户任职岗位标识 | SYS_USER_POST_ID |                                |
| 系统用户标识         | SYS_USER_ID      |                                |
| 系统岗位标识         | SYS_POST_ID      |                                |
| 电信组织标识         | ORG_ID           | 先界面传递，后续在缓存中获取到 |
| 是否默认登录系统岗位 | DEFAULT_FLAG     |                                |
| 是否主岗位           | HOST_FLAG        |                                |
| 生效时间             | EFF_DATE         |                                |
| 失效时间             | EXP_DATE         |                                |
| 状态                 | STATUS_CD        |                                |
| 状态时间             | STATUS_DATE      |                                |
| 创建时间             | CREATE_DATE      |                                |
| 创建人               | CREATE_STAFF     |                                |
| 修改时间             | UPDATE_DATE      |                                |
| 修改人               | UPDATE_STAFF     |                                |

#### 权限

页面权限、操作权限、数据权限

##### 权限与功能菜单

##### 功能说明

- 查询所有角色（黄炜炜）
- 按照权限分类查询 （文鑫），功能权限、数据权限
- 查询已有权限

- 角色授权功能（文鑫）

  给一个角色授权，前提要先有系统角色、权限

##### 流程说明

- 授权流程

  前台进入授权页面，先查询系统拥有的角色，点击角色，查询所有的权限，勾选权限送后端

##### 相关表

PRIVILEGE

PRIV_GRANT

| 授权标识         | PRIV_GRANT_ID  | ID                |
| ---------------- | -------------- | ----------------- |
| 权限标识         | PRIV_ID        | 权限ID            |
| 授权管理分类     | MANAGE_CLASS   | 默认1100 使用权限 |
| 授权对象类型     | GRANT_OBJ_TYPE | 默认1300 角色授权 |
| 授权对象标识     | GRANT_OBJ_ID   | 角色ID            |
| 授权操作类型     | OPER_TYPE      | 1000 默认正向操作 |
| 生效时间         | EFF_DATE       |                   |
| 失效时间         | EXP_DATE       |                   |
| 状态             | STATUS_CD      |                   |
| 状态时间         | STATUS_DATE    |                   |
| 创建时间         | CREATE_DATE    |                   |
| 创建人           | CREATE_STAFF   |                   |
| 修改时间         | UPDATE_DATE    |                   |
| 修改人           | UPDATE_STAFF   |                   |
| 关联功能权限标识 | PAR_PRIV_ID    | 空                |

##### api说明

- 查询所有权限

- 角色授权

  要有动作标识对权限增加还是删除，支持批量添加删除



#### 权限与数据

如何解决不同角色访问数据 不同 -福州只能查福州 ，厦门只能查厦门（不通过硬编码方式），只能查金额小于100 等等

  查询的sql语句要和权限相关联

##### 功能说明

##### 流程说明

##### 相关表

##### api说明

### 系统用户与权限



